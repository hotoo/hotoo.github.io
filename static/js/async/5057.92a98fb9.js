"use strict";(self.webpackChunkhotoo_co=self.webpackChunkhotoo_co||[]).push([["5057"],{6338:function(n,e,s){s.r(e),s.d(e,{default:()=>a});var t=s(4132),r=s(453);function c(n){let e=Object.assign({h1:"h1",a:"a",p:"p",h2:"h2",img:"img",footer:"footer",div:"div",strong:"strong",cite:"cite"},(0,r.ah)(),n.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(e.h1,{id:"每周异常第-3期宏观异常分析方法",children:["每周异常：第 3期，宏观异常分析方法",(0,t.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#每周异常第-3期宏观异常分析方法",children:"#"})]}),"\n",(0,t.jsx)(e.p,{children:"为了有效的分析 JavaScript 异常，我们从宏观的统计数据中做了大量的分析，初步结果如下："}),"\n",(0,t.jsxs)(e.h2,{id:"全站每日异常统计",children:["全站每日异常统计",(0,t.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#全站每日异常统计",children:"#"})]}),"\n",(0,t.jsx)(e.p,{children:"首先我们从每天的全站总体数据进行分析，得到下面这些报表。其中："}),"\n",(0,t.jsx)(e.p,{children:"\\n all\\npv: 全站所有有效异常次数 (PV)\n\\n all\\nuv: 全站所有有效异常人数 (UV)\n\\n all\\npv\\nrate: 全站所有异常率 (按 PV 统计)\n\\n all\\nuv\\nrate: 全站所有异常率 (按 UV 统计)\n\\n valid\\nrate\\npv: 有效异常率（按 PV 统计）\n\\n valid\\nrate\\nuv: 有效异常率（按 UV 统计）"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://f.cloud.github.com/assets/143572/900597/98aa3094%5Cnfb68%5Cn11e2%5Cn9f9e%5Cnc3809ea15b48.png",alt:"2013\\\\n08\\\\n02 7 42 02"})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://f.cloud.github.com/assets/143572/900599/ac59ccb2%5Cnfb68%5Cn11e2%5Cn89c3%5Cn4e0d6db7261f.png",alt:"2013\\\\n08\\\\n02 7 42 37"})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://f.cloud.github.com/assets/143572/900625/c145cbac%5Cnfb69%5Cn11e2%5Cn80c7%5Cnd1f9152ddeb4.png",alt:"2013\\\\n08\\\\n02 7 50 11"})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://f.cloud.github.com/assets/143572/900601/bbc1e3a6%5Cnfb68%5Cn11e2%5Cn85e7%5Cnb6443f502860.png",alt:"2013\\\\n08\\\\n02 7 43 04"})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://f.cloud.github.com/assets/143572/900602/cd4f7f0c%5Cnfb68%5Cn11e2%5Cn96b8%5Cn2de40b5d2882.png",alt:"2013\\\\n08\\\\n02 7 43 31"})}),"\n",(0,t.jsx)(e.p,{children:"从趋势图中我们可以明显的看到第 2天和最后一天，异常 PV 有较大波动，这是由于用户\n攻击爆发大量异常造成的。"}),"\n",(0,t.jsxs)(e.p,{children:["我们在 ",(0,t.jsx)(e.a,{href:"https://github.com/totorojs/javascript%5Cnexception%5Cnarchives/issues/12",target:"_blank",rel:"noopener noreferrer",children:"异常评分算法"}),"\n的讨论中有提到，即使是少量用户进行攻击，异常 UV 也不应该有波动的（除非页面 UV\n本身有较大波动），但是实际上我们看到最后一天的异常 UV 也有明显波动，因此粗略\n分析这个异常 PV 的上升是由于页面访问人数增多造成的。"]}),"\n",(0,t.jsx)(e.p,{children:"事后我们查了当天的页面访问 PV 和 UV，可惜并没有明显波动。"}),"\n",(0,t.jsx)(e.p,{children:"实际经过细致的异常日志分析，我们看到攻击用户同时没过一段时间就更换 IP 地址或清理\nCookie，因此全天的综合数据中异常 PV  和异常 UV 有了一些明显波动。"}),"\n",(0,t.jsx)(e.p,{children:"而且实际上，每天都有攻击造成的异常波动。\n\\n 每天都有攻击造成的异常，累加在一起好像每天都没什么问题。\n\\n 由于攻击造成异常总数相对一天的异常总数太小，从全天异常总数的层面来看，\n无法发现，甚至排除攻击造成的异常。\n\\n T+1 的统计数据，对于异常监控来说，太迟钝了。"}),"\n",(0,t.jsxs)(e.h2,{id:"全站每分钟异常统计",children:["全站每分钟异常统计",(0,t.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#全站每分钟异常统计",children:"#"})]}),"\n",(0,t.jsx)(e.p,{children:"从上面每日异常总和的分析我们可以看出，一天的总和数据能发现的问题还是比较有限的。\n于是我从分钟的粒度来统计异常。"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://f.cloud.github.com/assets/143572/900781/7496f1e6%5Cnfb6e%5Cn11e2%5Cn854f%5Cn1a0f685bea15.png",alt:"2013\\\\n08\\\\n02 7 24 54"})}),"\n",(0,t.jsx)(e.p,{children:"图有点大，点击可以看大图。"}),"\n",(0,t.jsx)(e.p,{children:"从图中我们可以看到，凌晨 2点多到 3点多期间，有少量用户发起了猛烈的攻击；\n凌晨 4点多到凌晨7点多期间也有少量温和的攻击。攻击时全站异常 PV （绿色）\n和全站有效异常（深红色）明显飙升，但是异常 UV 和有效异常 UV 都没有太大波动，\n而且与前后的时间切片有较好的连贯性，没有大起大落。"}),"\n",(0,t.jsx)(e.p,{children:"而如果异常 UV 出现较大波动，在很可能是由于我们正在发布的新代码影响大面积用户。"}),"\n",(0,t.jsx)(e.p,{children:"合适的时间粒度对于及时发现真正有效的异常有非常重要的意义。"}),"\n",(0,t.jsxs)("footer",{class:"blog-post-footer",children:[(0,t.jsx)("div",{class:"blog-post-footer-meta meta-left",children:(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Tags:"})," ",(0,t.jsx)("a",{href:"/blog/tags/%E6%AF%8F%E5%91%A8%E5%BC%82%E5%B8%B8",children:(0,t.jsx)("cite",{class:"tags",children:"每周异常"})})]})}),(0,t.jsx)("div",{class:"blog-post-footer-meta meta-right",children:(0,t.jsxs)(e.p,{children:["Published on ",(0,t.jsx)("cite",{class:"date",children:"2013-08-02"})]})})]})]})}function i(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}=Object.assign({},(0,r.ah)(),n.components);return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(c,{...n})}):c(n)}let a=i;i.__RSPRESS_PAGE_META={},i.__RSPRESS_PAGE_META["..%2Fnode_modules%2F.rspress%2Fruntime%2Ftemp-52.mdx"]={toc:[{text:"全站每日异常统计",id:"全站每日异常统计",depth:2},{text:"全站每分钟异常统计",id:"全站每分钟异常统计",depth:2}],title:"每周异常：第 3期，宏观异常分析方法",headingTitle:"每周异常：第 3期，宏观异常分析方法",frontmatter:{category:null,tags:"每周异常",date:"2013-08-02T00:00:00.000Z",sidebar:!1,footer:!1}}}}]);