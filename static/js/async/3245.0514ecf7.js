"use strict";(self.webpackChunkhotoo_github_io=self.webpackChunkhotoo_github_io||[]).push([["3245"],{521:function(e,t,n){n.r(t),n.d(t,{default:()=>s});var r=n(74132),l=n(40453);function a(e){let t=Object.assign({h1:"h1",a:"a",p:"p",pre:"pre",code:"code",ul:"ul",li:"li",h2:"h2"},(0,l.ah)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(t.h1,{id:"深入-hasattribute",children:["深入 hasAttribute",(0,r.jsx)(t.a,{className:"header-anchor","aria-hidden":"true",href:"#深入-hasattribute",children:"#"})]}),"\n",(0,r.jsx)(t.p,{children:"众所周知，IE 的 HTMLElement 对象不支持 hasAttribute 方法，于是有了如下实现：\n它针对不支持 hasAttribute 方法的浏览器，检查 getAttribute 得到的是否等于 null，\n如果是 null 则表明这个 HTMLElement 不存在指定的 Attribute。很聪明的一个方法。"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-js",children:"function hasAttr(elem, attr){\n    if(elem.hasAttribute){\n        return elem.hasAttribute(attr);\n    }\n    return null!=elem.getAttribute(attr);\n}\n"})}),"\n",(0,r.jsxs)(t.p,{children:["最近写了个原理简单的基于 Select+Input 的可编辑 ",(0,r.jsx)(t.a,{href:"http://hotoo.me/labs/combox.html",target:"_blank",rel:"noopener noreferrer",children:"Combox"}),"\n控件，用到了这个方法来检查目标 select\n对象是否存在如 multiple, editable 这样的属性，来实现不同的 Combox 版本。其他\n浏览器上跑的很好，但是在 IE6 上却总是被初始化为 multiple 的实例，很明显，这个\nhasAttribute 的实现出问题了。"]}),"\n",(0,r.jsx)(t.p,{children:"原来针对 IE6，还有稍多一点的特殊性："}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:'input.getAttribute("checked")'})," 返回 Boolean 值，true/false；","\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:'input[type=checkbox|radio].getAttribute("checked")'})," 根据他的 checked 状态相关；"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:'input[type=others...].getAttribute("checked")'})," 始终返回 false；"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:'select.getAttribute("multiple")'})," 返回 Boolean 值；"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:'select>option.getAttribute("selected")'})," 返回 Boolean 值。"]}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:'虽然可以通过 getAttribute("checked") 判断 checkbox/radio 的属性状况，但对于\n其他类型的 input 元素，是无法准确获得 checked 属性的。'}),"\n",(0,r.jsx)(t.p,{children:"TODO: checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"}),"\n",(0,r.jsx)(t.p,{children:"下面是比较完整一点的实现："}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-js",children:'function hasAttr(elem, attr){\n    var tag = elem.tagName.toLowerCase();\n    attr = attr.toLowerCase();\n    if(elem.hasAttribute){\n        return elem.hasAttribute(attr);\n    }\n    if(navigator.userAgent.indexOf("MSIE 6")>0 &&\n        (("input"==tag && "checked"==attr) ||\n        ("option"==tag && "selected"==attr) ||\n        ("select"==tag && "multiple"==attr))){\n        return elem.getAttribute(attr);\n    }\n    return null!=elem.getAttribute(attr);\n}\n'})}),"\n",(0,r.jsxs)(t.h2,{id:"update-20110726",children:["Update 2011/07/26",(0,r.jsx)(t.a,{className:"header-anchor","aria-hidden":"true",href:"#update-20110726",children:"#"})]}),"\n",(0,r.jsx)(t.p,{children:"继续发现新坑：IE 中下面的代码"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-html",children:'<p></p>\n<q onclick="alert(0);"></q>\n\n<script>\n    p.onclick = function(){};\n\n    alert(p.getAttribute("onclick"));\n    alert(q.getAttribute("onclick"));\n<\/script>\n'})}),"\n",(0,r.jsx)(t.p,{children:"输出："}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-js",children:"function(){}\n\nfunction onclick()\n{\nalert(0);\n}\n"})}),"\n",(0,r.jsxs)(t.p,{children:["所以上面的 ",(0,r.jsx)(t.code,{children:"hasAttr"})," 函数是无法正确返回这种在脚本中设置 ",(0,r.jsx)(t.code,{children:"onclick"})," 值的。"]}),"\n",(0,r.jsx)(t.p,{children:"对策："}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-js",children:'var hasAttr = function(elem, attr){\n    if(!elem || 1!=elem.nodeType){return false;}\n    if(elem.hasAttribute){return elem.hasAttribute(attr);}\n    // for IE, not perfect.\n    // @see http://www.patmullin.com/weblog/2006/04/06/getattributestyle-setattributestyle-ie-dont-mix/\n    attr = attr.toLowerCase();\n    if("style" == attr){return "" !== elem.style.cssText;}\n    if(navigator.userAgent.indexOf("MSIE 6")>0 &&\n        (("input"==tag && "checked"==attr) ||\n        ("option"==tag && "selected"==attr) ||\n        ("select"==tag && "multiple"==attr))){\n        return elem.getAttribute(attr);\n    }\n    var val = elem.getAttribute(attr);\n    if(null == val){return false;}\n    else if("function" == typeof(val)){\n        return val.toString().indexOf("function "+attr+"()") == 0;\n    }else{return true;}\n};\n'})}),"\n",(0,r.jsxs)(t.h2,{id:"update-20111026",children:["Update 2011/10/26",(0,r.jsx)(t.a,{className:"header-anchor","aria-hidden":"true",href:"#update-20111026",children:"#"})]}),"\n",(0,r.jsxs)(t.p,{children:["继续新坑，IE5,6,7 的 ",(0,r.jsx)(t.code,{children:'script.getAttribute("src") === ""'}),"，正常的 DOM 方法已经\n阻止不了 IE 了，hack 方案可以解析 wrapHTML(node){return outerHTML.startTag;}，\n判断是否有 src 属性。"]}),"\n",(0,r.jsx)(t.p,{children:"如果在这里你真的可以忽略 IE，最佳方案还是屏蔽 IE 吧。"})]})}function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:t}=Object.assign({},(0,l.ah)(),e.components);return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}let s=i;i.__RSPRESS_PAGE_META={},i.__RSPRESS_PAGE_META["blog%2Fpost%2F2011%2Fhasattribute.md"]={toc:[{text:"Update 2011/07/26",id:"update-20110726",depth:2},{text:"Update 2011/10/26",id:"update-20111026",depth:2}],title:"深入 hasAttribute",headingTitle:"深入 hasAttribute",frontmatter:[{template:"post.html"},{pubdate:"2011-05-19T00:00:00.000Z"},{tags:"JavaScript"}]}}}]);