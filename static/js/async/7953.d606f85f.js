"use strict";(self.webpackChunkhotoo_github_io=self.webpackChunkhotoo_github_io||[]).push([["7953"],{35506:function(e,n,r){r.r(n),r.d(n,{default:()=>o});var s=r(74132),t=r(40453);function l(e){let n=Object.assign({h1:"h1",a:"a",p:"p",code:"code",img:"img",ul:"ul",li:"li",pre:"pre",em:"em"},(0,t.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.h1,{id:"发现-safari4-的-select-控件-bug",children:["发现 Safari4 的 select 控件 bug",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#发现-safari4-的-select-控件-bug",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["昨天看了新的",(0,s.jsx)(n.a,{href:"https://www.taobao.com/",target:"_blank",rel:"noopener noreferrer",children:"淘宝首页"}),"，非常赞，有不少模仿/参考Yahoo 的成分。"]}),"\n",(0,s.jsxs)(n.p,{children:["当时用的Safari 4 Public Beta (528.16)（后来用同事的Safari 4.0.2 (530.19.1)也一样），偶然点到预订机票的页签，随便点了几下选择框(",(0,s.jsx)(n.code,{children:"<select>"}),")，2月，28天，正常；3月，28天？；4 月，28天！…"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://farm3.static.flickr.com/2659/4246970340_ee2cabeefc_o.png",alt:""})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://www.flickr.com/photos/hotoo/4246970340/",target:"_blank",rel:"noopener noreferrer",children:"Safari 4 select bug(Windows)"})}),"\n",(0,s.jsx)(n.p,{children:"另外在IE 7, FF3.5, Chrome 4, Opera 10上测试却都是正常的。"}),"\n",(0,s.jsx)(n.p,{children:"源码很易读，逻辑上没有什么问题，几点建议："}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["清空选项框建议使用遍历并 ",(0,s.jsx)(n.code,{children:"selDay.remove(0);"}),"；\r\n（一时忘记在什么情况下 ",(0,s.jsx)(n.code,{children:"selDay.options.length = 0;"})," 会有问题了）"]}),"\n",(0,s.jsxs)(n.li,{children:["在创建好 Option 对象之后再 ",(0,s.jsx)(n.code,{children:"selMonth.options[month].selected = true;"})," 和\r\n",(0,s.jsx)(n.code,{children:"selDay.options[day-startDay].selected = true;"})," 就可以了，无需在循环时一一判断；"]}),"\n",(0,s.jsx)(n.li,{children:"另外关于转换不存在的日期（如2月31日）时，在这里其实没有什么用处的，\r\n转出来的日期基本也不会是用户期望的日期（用户期望是2月某日，却跑到了3月），\r\n遇到这种情况，变成2月1日或2月28日就可以了，而无需给出任何（讨厌的alert）提示。"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"这都不是造成这个bug的原因，打印各个关键的运行时变量值都是正常的，但在界面是就是没有显示出来。"}),"\n",(0,s.jsxs)(n.p,{children:["今天 5 号，把昨天没有确定（是当时机器，或者当时浏览器）的问题拿出来再看，\r\n发现2,3,4…月都只有27天了，这个值与第一次产生的 ",(0,s.jsx)(n.code,{children:"options.length"}),"相等。\r\n注释掉 519: ",(0,s.jsx)(n.code,{children:"//startDay = now.getDate();"})," ，让 "," 最初长度为31，\r\n再转到2月，发现最后多了好几个不能点击的可见选项，此时浏览器也经常性崩溃。"]}),"\n",(0,s.jsx)(n.p,{children:"这应该是渲染引擎的问题，而针对 IE 激活重新渲染的代码也无效："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'function reflow(){\r\n    var b = document.body;\r\n    // b.style.zoom = b.style.zoom=="1"?"100%":"1";\r\n    // b.style.zoom = 1.1;\r\n    // b.style.zoom = \'\';\r\n    b.style.display = "none";\r\n    b.style.display = "";\r\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"但是淘宝紧邻预订机票左侧页签的“游戏快冲”却没有这个问题，于是怀疑是跟 Option 的个数有关。"}),"\n",(0,s.jsxs)(n.p,{children:["经过更多的实验分析， ",(0,s.jsx)(n.em,{children:"结论"})," 是超出24个 Option 之后的选项，渲染就会出问题，\r\n而恰巧? Safari 4 默认最大下拉长度也是24个。"]})]})}function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,t.ah)(),e.components);return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}let o=i;i.__RSPRESS_PAGE_META={},i.__RSPRESS_PAGE_META["blog%2Fpost%2F2010%2Fsafari-4-select-bug.md"]={toc:[],title:"发现 Safari4 的 select 控件 bug",headingTitle:"发现 Safari4 的 select 控件 bug",frontmatter:{date:"2010-01-05T00:00:00.000Z",tags:"Browser, BUG"}}}}]);