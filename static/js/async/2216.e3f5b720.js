"use strict";(self.webpackChunkhotoo_github_io=self.webpackChunkhotoo_github_io||[]).push([["2216"],{86570:function(e,n,t){t.r(n),t.d(n,{default:()=>o});var r=t(74132),i=t(40453);function s(e){let n=Object.assign({h1:"h1",a:"a",p:"p",img:"img",h2:"h2",blockquote:"blockquote",pre:"pre",code:"code",ul:"ul",li:"li"},(0,i.ah)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.h1,{id:"使用-gpg-签名-git-commits",children:["使用 GPG 签名 Git Commits",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#使用-gpg-签名-git-commits",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"前段时间 GitHub 支持在 Git Commits 中使用 GPG 签名验证，可以避免其他人使用你的\nEmail 进行 commit。"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"/images/blog/2016/gpg.png",alt:"GPG"})}),"\n",(0,r.jsxs)(n.h2,{id:"安装-gpg",children:["安装 GPG",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#安装-gpg",children:"#"})]}),"\n",(0,r.jsxs)(n.p,{children:["下载地址： ",(0,r.jsx)(n.a,{href:"https://www.gnupg.org/download/",target:"_blank",rel:"noopener noreferrer",children:"https://www.gnupg.org/download/"})]}),"\n",(0,r.jsxs)(n.p,{children:["Mac 下有两个可选工具，分别是 ",(0,r.jsx)(n.a,{href:"https://gpgtools.org/",target:"_blank",rel:"noopener noreferrer",children:"Mac GPG"})," 和 GnuPG for OS X，我都尝试了下，觉得\nMac GPG 相对比较容易点，安装过程中同时引导创建一个 GPG key 存储到 GPG keychain\n中，并且在 Git 提交时记住 passphrase，避免每次提交输入 passphrase。"]}),"\n",(0,r.jsxs)(n.h2,{id:"生成-gpg-key",children:["生成 GPG key",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#生成-gpg-key",children:"#"})]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"如果在安装过程中，自动引导生成了 GPG key 的话，这一步可以省略。"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"除了安装时引导生成的 GPG key 之外，你还可以手动生成 GPG key："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'$ gpg --gen-key\ngpg (GnuPG/MacGPG2) 2.0.28; Copyright (C) 2015 Free Software Foundation, Inc.\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.\n\nPlease select what kind of key you want:\n   (1) RSA and RSA (default)\n   (2) DSA and Elgamal\n   (3) DSA (sign only)\n   (4) RSA (sign only)\nYour selection?\nRSA keys may be between 1024 and 4096 bits long.\nWhat keysize do you want? (2048)\nRequested keysize is 2048 bits\nPlease specify how long the key should be valid.\n         0 = key does not expire\n      <n>  = key expires in n days\n      <n>w = key expires in n weeks\n      <n>m = key expires in n months\n      <n>y = key expires in n years\nKey is valid for? (0) 1y\nKey expires at 日  6/11 22:33:50 2017 CST\nIs this correct? (y/N) y\n\nGnuPG needs to construct a user ID to identify your key.\n\nReal name: xxx\nEmail address: xxx@yyy.com\nComment:\nYou selected this USER-ID:\n    "xxx <xxx@yyy.com>"\n\nChange (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit?\nChange (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit? O\nYou need a Passphrase to protect your secret key.\n\nWe need to generate a lot of random bytes. It is a good idea to perform\nsome other action (type on the keyboard, move the mouse, utilize the\ndisks) during the prime generation; this gives the random number\ngenerator a better chance to gain enough entropy.\nWe need to generate a lot of random bytes. It is a good idea to perform\nsome other action (type on the keyboard, move the mouse, utilize the\ndisks) during the prime generation; this gives the random number\ngenerator a better chance to gain enough entropy.\ngpg: key B5DB6617 marked as ultimately trusted\npublic and secret key created and signed.\n\ngpg: checking the trustdb\ngpg: 3 marginal(s) needed, 1 complete(s) needed, PGP trust model\ngpg: depth: 0  valid:   3  signed:   0  trust: 0-, 0q, 0n, 0m, 0f, 3u\ngpg: next trustdb check due at 2017-06-11\npub   2048R/B5DB6617 2016-06-11 [expires: 2017-06-11]\n      Key fingerprint = 3AE5 19D5 8A58 C59B B029  6CEA 8566 6A47 B5DB 6617\nuid       [ultimate] xxx <xxx@yyy.com>\nsub   2048R/1F4A9B85 2016-06-11 [expires: 2017-06-11]\n'})}),"\n",(0,r.jsxs)(n.h2,{id:"配置-git",children:["配置 Git",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#配置-git",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"配置好 GPG key 之后，可以配置让 git 在某个仓库所有的 commits 都添加 GPG key 验证："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"git config commit.gpgsign true\n"})}),"\n",(0,r.jsx)(n.p,{children:"也可以让本地所有的仓库都进行 GPG 验证："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"$ git config --global commit.gpgsign true\n"})}),"\n",(0,r.jsxs)(n.h2,{id:"验证-git-commits",children:["验证 Git commits",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#验证-git-commits",children:"#"})]}),"\n",(0,r.jsxs)(n.p,{children:["如果没有设置局部仓库或全局仓库默认开启 commits GPG 验证，提交时可以附加 ",(0,r.jsx)(n.code,{children:"-S"})," 参考，\n要求进行 GPG 验证。"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'$ git commit -S -m "comment"\n'})}),"\n",(0,r.jsx)(n.p,{children:"如果提交使用的账户信息和 GPG 签名不一致，则无法通过 GPG 验证，会导致提交失败。"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'$ git ci -m "test"\ngpg: skipped "ZZZ <xxx@yyy.com>": No secret key\ngpg: signing failed: No secret key\nerror: gpg failed to sign the data\nfatal: failed to write commit object\n'})}),"\n",(0,r.jsx)(n.p,{children:"正常的话，会提示输入 passphrase 解锁 PGP 密钥，此时可以选中保存到 Mac OS X 系统\n的 Keychain 中，避免每次输入 passphrase。"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'$ git add .\n$ git ci -m "test"\n\nYou need a passphrase to unlock the secret key for\nuser: "xxx <xxx@yyy.com>"\n4096-bit RSA key, ID C0B176D7, created 2016-06-11\n\n[master (root-commit) 163d909] test\n 1 file changed, 3 insertions(+)\n create mode 100644 README.md\n'})}),"\n",(0,r.jsxs)(n.h2,{id:"将-gpg-密钥添加到-github",children:["将 GPG 密钥添加到 GitHub",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#将-gpg-密钥添加到-github",children:"#"})]}),"\n",(0,r.jsxs)(n.p,{children:["这时 push 到 GitHub 仓库的 commits，查看 commits 记录会显示 ",(0,r.jsx)(n.code,{children:"unverified"}),"。"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"$ gpg --list-secret-keys\n/Users/xxx/.gnupg/secring.gpg\n-------------------------------\nsec   4096R/C0B176D7 2016-06-11 [expires: 2020-06-11]\nuid                  xxx <xxx@yyy.com>\nssb   4096R/E00F263F 2016-06-11\n\n$ gpg --armor --export C0B176D7\n-----BEGIN PGP PUBLIC KEY BLOCK-----\nComment: GPGTools - https://gpgtools.org\n\n****************************************************************\n****************************************************************\n****************************************************************\n************************************************\n*****\n-----END PGP PUBLIC KEY BLOCK-----\n"})}),"\n",(0,r.jsxs)(n.p,{children:["将上面 export 出来的 GPG 密钥添加到 GitHub 的 ",(0,r.jsx)(n.a,{href:"https://github.com/settings/keys",target:"_blank",rel:"noopener noreferrer",children:"SSH and GPG keys"})," 即可。"]}),"\n",(0,r.jsxs)(n.h2,{id:"参考",children:["参考",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#参考",children:"#"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/blog/2144-gpg-signature-verification",target:"_blank",rel:"noopener noreferrer",children:"GPG signature verification"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://help.github.com/articles/signing-commits-using-gpg/",target:"_blank",rel:"noopener noreferrer",children:"Signing commits using GPG"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://help.github.com/articles/generating-a-new-gpg-key/",target:"_blank",rel:"noopener noreferrer",children:"Generating a new GPG key"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://help.github.com/articles/adding-a-new-gpg-key-to-your-github-account/",target:"_blank",rel:"noopener noreferrer",children:"Adding a new GPG key to your GitHub account"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.gnupg.org/download/",target:"_blank",rel:"noopener noreferrer",children:"GnuPG - download"})}),"\n"]}),"\n",(0,r.jsxs)(n.h2,{id:"延伸阅读",children:["延伸阅读",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#延伸阅读",children:"#"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://mikegerwitz.com/papers/git-horror-story",target:"_blank",rel:"noopener noreferrer",children:"A Git Horror Story: Repository Integrity With Signed Commits"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.oschina.net/translate/git-horror-story",target:"_blank",rel:"noopener noreferrer",children:"Git 使用中的教训：签名提交确保代码完整可信"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://arondight.me/2016/04/17/%E4%BD%BF%E7%94%A8GPG%E7%AD%BE%E5%90%8DGit%E6%8F%90%E4%BA%A4%E5%92%8C%E6%A0%87%E7%AD%BE/",target:"_blank",rel:"noopener noreferrer",children:"使用 GPG 签名 Git 提交和标签"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/pstadler/keybase-gpg-github",target:"_blank",rel:"noopener noreferrer",children:"Step-by-step guide on how to create a GPG key on keybase.io, adding it to a local GPG setup and use it with Git and GitHub"})}),"\n"]})]})}function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,i.ah)(),e.components);return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(s,{...e})}):s(e)}let o=a;a.__RSPRESS_PAGE_META={},a.__RSPRESS_PAGE_META["blog%2Fpost%2F2016%2Fgpg-sign-for-git-comments.md"]={toc:[{text:"安装 GPG",id:"安装-gpg",depth:2},{text:"生成 GPG key",id:"生成-gpg-key",depth:2},{text:"配置 Git",id:"配置-git",depth:2},{text:"验证 Git commits",id:"验证-git-commits",depth:2},{text:"将 GPG 密钥添加到 GitHub",id:"将-gpg-密钥添加到-github",depth:2},{text:"参考",id:"参考",depth:2},{text:"延伸阅读",id:"延伸阅读",depth:2}],title:"使用 GPG 签名 Git Commits",headingTitle:"使用 GPG 签名 Git Commits",frontmatter:{date:"2016-06-11T00:00:00.000Z",tags:"Git, GPG"}}}}]);