"use strict";(self.webpackChunkhotoo_github_io=self.webpackChunkhotoo_github_io||[]).push([["5786"],{87200:function(e,r,n){n.r(r),n.d(r,{default:()=>a});var t=n(74132),i=n(40453);function o(e){let r=Object.assign({h1:"h1",a:"a",p:"p",blockquote:"blockquote",pre:"pre",code:"code",h2:"h2",ul:"ul",li:"li"},(0,i.ah)(),e.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(r.h1,{id:"每周异常第-10期异常评分算法",children:["每周异常：第 10期，异常评分算法",(0,t.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#每周异常第-10期异常评分算法",children:"#"})]}),"\n",(0,t.jsx)(r.p,{children:"abc"}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsxs)(r.p,{children:["本文同步发表于『",(0,t.jsx)(r.a,{href:"https://github.com/totorojs/javascript-exception-archives/issues/19",target:"_blank",rel:"noopener noreferrer",children:"JavaScript 异常档案库"}),"』，\n欢迎 Star, Watch, Fork & Pull Request."]}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:"经过不知多少次的纠结、学习与尝试，我们来对异常评分算法做一个了结。"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-js",children:"function wilsonScore(phat, n, z){\n  return (phat + z*z/(2*n) - z * Math.sqrt((phat*(1-phat)+z*z/(4*n))/n)) /\n    (1+z*z/n);\n}\n\nfunction errorScore(error_pv, page_pv){\n  var phat = error_pv * 1000 * 10 / page_pv;\n  return wilsonScore(phat, page_pv, 1.96);\n}\n"})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-sql",children:"SELECT\n  jserror.url AS url,\n  jserror.pv AS pv,\n  vist.pv_cnt AS page_pv,\n  jserror.pv * 10000 / vist.pv_cnt AS pv_rate,\n  jserror.uv AS uv,\n  vist.client_ip_cnt AS page_uv,\n  jserror.uv * 10000 / vist.client_ip_cnt AS uv_rate,\n  (jserror.pv/vist.pv_cnt + 1.96*1.96/(2*vist.pv_cnt) - 1.96 * sqrt((jserror.pv/vist.pv_cnt*(1-jserror.pv/vist.pv_cnt)+1.96*1.96/(4*vist.pv_cnt))/vist.pv_cnt)) / (1+1.96*1.96/vist.pv_cnt) AS score,\n  jserror.dt AS dt\nFROM orgin_log_table vist\nINNER JOIN(\n  SELECT\n    url,\n    count(ip) as pv,\n    count(distinct ip) AS uv,\n    dt\n  FROM jserror_origin_{YYYYMMDD-1D}\n  WHERE\n    file RLIKE '^https?://\\\\w+\\\\.example\\\\.com/'\n    AND line != '0'\n    AND top_level_domain = 'example.com'\n    AND is_first_occur = '1'\n  GROUP BY dt, url\n) jserror\nON\n  vist.full_url = jserror.url\n  AND vist.dt = jserror.dt\n  AND vist.pv_cnt > 10000\nORDER BY score DESC\n"})}),"\n",(0,t.jsxs)(r.h2,{id:"参考",children:["参考",(0,t.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#参考",children:"#"})]}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"http://www.evanmiller.org/how-not-to-sort-by-average-rating.html",target:"_blank",rel:"noopener noreferrer",children:"How Not To Sort By Average Rating"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"http://www.ruanyifeng.com/blog/2012/02/ranking_algorithm_hacker_news.html",target:"_blank",rel:"noopener noreferrer",children:"基于用户投票的排名算法（一）：Delicious和Hacker News"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"http://www.ruanyifeng.com/blog/2012/03/ranking_algorithm_reddit.html",target:"_blank",rel:"noopener noreferrer",children:"基于用户投票的排名算法（二）：Reddit"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"http://www.ruanyifeng.com/blog/2012/03/ranking_algorithm_stack_overflow.html",target:"_blank",rel:"noopener noreferrer",children:"基于用户投票的排名算法（三）：Stack Overflow"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"http://www.ruanyifeng.com/blog/2012/03/ranking_algorithm_newton_s_law_of_cooling.html",target:"_blank",rel:"noopener noreferrer",children:"基于用户投票的排名算法（四）：牛顿冷却定律"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"http://www.ruanyifeng.com/blog/2012/03/ranking_algorithm_wilson_score_interval.html",target:"_blank",rel:"noopener noreferrer",children:"基于用户投票的排名算法（五）：威尔逊区间"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"http://www.ruanyifeng.com/blog/2012/03/ranking_algorithm_bayesian_average.html",target:"_blank",rel:"noopener noreferrer",children:"基于用户投票的排名算法（六）：贝叶斯平均"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"http://en.wikipedia.org/wiki/Binomial_proportion_confidence_interval#Wilson_score_interval",target:"_blank",rel:"noopener noreferrer",children:"Binomial proportion confidence interval"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"http://en.wikipedia.org/wiki/Confidence_interval",target:"_blank",rel:"noopener noreferrer",children:"置信区间(Confidence_interval)"})}),"\n"]})]})}function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:r}=Object.assign({},(0,i.ah)(),e.components);return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}let a=l;l.__RSPRESS_PAGE_META={},l.__RSPRESS_PAGE_META["blog%2Fpost%2F2013%2Fweekly-topic-about-exceptions-10.md"]={toc:[{text:"参考",id:"参考",depth:2}],title:"每周异常：第 10期，异常评分算法",headingTitle:"每周异常：第 10期，异常评分算法",frontmatter:[{template:"post.html"},{date:"2013-09-25T00:00:00.000Z"},{tags:"每周异常"},{status:"draft"}]}}}]);